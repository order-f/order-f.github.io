<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>86754ebf71a94fb1a99c1bd96481e6fa</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div id="dc261cc4" class="cell markdown">
<h2
id="monte-carlo-pricing-of-european-vanilla-and-binary-call-options"><strong>Monte
Carlo pricing of European vanilla and binary call options</strong></h2>
<p>Yin Hei Chow</p>
<head>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> 
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"></script>
</head>
</div>
<div id="8d906e42" class="cell markdown">
<h3 id="introduction">Introduction</h3>
<p>This report focuses on the pricing of European vanilla and binary
call options using Monte Carlo schemes. Binary calls herein refers to
European-style cash-or-nothing binary calls, which payoff one or zero
depending on whether the underlying has a price above the pre-agreed
strike at maturity. The underlying stock <span
class="math inline"><em>S</em><sub><em>t</em></sub></span> in the
equivalent martingale measure <span
class="math inline"><em>Q</em></span> obeys the following stochastic
differential equation (SDE): <span
class="math display"><em>d</em><em>S</em><sub><em>t</em></sub> = (<em>r</em>−<em>D</em>)<em>d</em><em>t</em> + <em>σ</em><em>d</em><em>W</em><sub><em>t</em></sub></span>
where <span class="math inline"><em>W</em><sub><em>t</em></sub></span>
is the Wiener process in <span class="math inline"><em>Q</em></span>,
<span class="math inline"><em>σ</em></span> is the volatility, <span
class="math inline"><em>r</em></span> is the risk-free rate, <span
class="math inline"><em>D</em></span> is the dividend yield of the
stock, and time <span class="math inline"><em>t</em></span> ranges from
the present ( assumed WLOG to be <span
class="math inline"><em>t</em> = 0</span> ) to the expiration <span
class="math inline"><em>t</em> = <em>T</em></span> of the contract. The
process <span
class="math inline"><em>S</em><em>e</em><sup><em>D</em><em>t</em></sup>/<em>B</em>(<em>t</em>)</span>,
where <span class="math inline"><em>B</em></span> is the zero-coupon
bond paying at <span class="math inline"><em>r</em></span>, is a
martingale. Continuous dividends are considered since it is a variable
that I would like to vary to probe its effect on the errors of
respective numerical schemes.</p>
<p>Three numerical schemes for sampling the process <span
class="math inline"><em>S</em><sub><em>t</em></sub></span> from the
above SDE will be studied: Euler-Maruyama scheme, Milstein scheme, and
its closed-form solution. The discretization under the schemes are as
follows</p>
<p><span class="math display">$$
\begin{align*}
&amp;\text{Euler-Maruyama: }&amp;S(t_{i+1})=S(t_i)\bigg[1+(r-D)\delta
t+\sigma\phi_i\sqrt{\delta t}\bigg]\\
&amp;\text{Milstein: }&amp;S(t_{i+1})=S(t_i)\bigg[1+(r-D)\delta t
+\sigma\phi_i\sqrt{\delta t}+\frac{1}{2}\sigma^2(\phi_i^2-1)\delta
t\bigg]\\
&amp;\text{Closed-form solution:
}&amp;S(t_{i+1})=S(t_i)e^{(r-D-\frac{1}{2}\sigma^2)\delta
t+\sigma\phi_i\sqrt{\delta t}}
\end{align*}
$$</span></p>
<p>For any finite discretization time-step <span
class="math inline"><em>δ</em><em>t</em></span>, only the path <span
class="math inline"><em>S</em>(<em>t</em><sub><em>i</em></sub>)</span>
generated by the closed form solution will give the exact terminal price
<span class="math inline"><em>S</em><sub><em>T</em></sub></span> for the
subsequent determination of any contract's payoff. Note also that
lognormal random walks is one of the few examples where the Milstein
scheme could be used since the coefficient of the Milstein correction
term may not admit closed forms for Ito processes in general.</p>
<p>A European call, denoted <span class="math inline"><em>C</em></span>,
with strike <span class="math inline"><em>K</em></span> has the
following payoff at maturity <span
class="math display"><em>C</em>(<em>S</em><sub><em>T</em></sub>,<em>T</em>) = <em>m</em><em>a</em><em>x</em>{0, <em>S</em><sub><em>T</em></sub> − <em>K</em>}</span>
while that for a binary call, denoted <span
class="math inline"><em>C</em><sub><em>B</em></sub></span>, with the
same strike is <span
class="math display"><em>C</em><sub><em>B</em></sub>(<em>S</em><sub><em>T</em></sub>,<em>T</em>) = <em>u</em>(<em>S</em><sub><em>T</em></sub>−<em>K</em>)</span>
where <span class="math inline"><em>u</em></span> is the Heaviside step
function. The pricing problem is to determine the risk-neutral present
values of these contracts <span
class="math display"><em>C</em>(0) ≔ <em>C</em>(<em>S</em><sub>0</sub>,0)</span>
<span
class="math display"><em>C</em><sub><em>B</em></sub>(0) ≔ <em>C</em><sub><em>B</em></sub>(<em>S</em><sub>0</sub>,0)</span></p>
<p>given the following information: a constant level of volatility, a
constant risk-free rate, the spot price <span
class="math inline"><em>S</em>(0)</span> of the underlying, the strike
and maturity of the contract. The Monte Carlo pricing method generates,
under the risk-neutral measure, realizations of the stock price in the
forthcoming period with the abovementioned discretization schcemes. Then
the distribution of terminal stock price is used to determined an
expected payoff of each contract, which is in turn discounted back to
the present to determined the risk-neutral price. Put differenly, for a
contract <span class="math inline"><em>V</em> = <em>C</em></span> or
<span class="math inline"><em>C</em><sub><em>B</em></sub></span>, it has
the risk-neutral price of <span
class="math display"><em>V</em>(0) = <em>e</em><sup>−<em>r</em><em>T</em></sup><em>E</em><sup><em>Q</em></sup>[<em>V</em>(<em>S</em><sub><em>T</em></sub>,<em>T</em>)]</span></p>
</div>
<div id="16364533" class="cell markdown">
<h3
id="results--discussion-error-analysis-interesting-observations-and-problems-encountered">Results
&amp; Discussion: Error analysis, interesting observations and problems
encountered</h3>
<p>Start by loading the required modules and defining the three sampling
schemes</p>
</div>
<div id="411e3f94" class="cell code">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># version</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip freeze <span class="op">&gt;</span> requirements.txt</span></code></pre></div>
</div>
<div id="7e78c0a6" class="cell code" data-execution_count="1">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> curve_fit</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> cm</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> LinearLocator</span></code></pre></div>
</div>
<div id="d01a357c" class="cell code" data-execution_count="2">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Euler_Maruyama(spot, mu, sigma, horizon, timesteps, nsims, seed):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    np.random.seed(seed)  <span class="co"># sharing the seed among schemes</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> horizon<span class="op">/</span>timesteps  <span class="co"># time-step size</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> np.zeros((timesteps,nsims))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    S[<span class="dv">0</span>] <span class="op">=</span> spot</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, timesteps<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> np.random.standard_normal(nsims)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        S[i<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> S[i]<span class="op">*</span>( <span class="dv">1</span> <span class="op">+</span> mu<span class="op">*</span>dt <span class="op">+</span> sigma<span class="op">*</span>np.sqrt(dt)<span class="op">*</span>w )</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> S</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Milstein(spot, mu, sigma, horizon, timesteps, nsims, seed):</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    np.random.seed(seed)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> horizon<span class="op">/</span>timesteps</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> np.zeros((timesteps,nsims))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    S[<span class="dv">0</span>] <span class="op">=</span> spot</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, timesteps<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> np.random.standard_normal(nsims)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        S[i<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> S[i]<span class="op">*</span>( <span class="dv">1</span> <span class="op">+</span> mu<span class="op">*</span>dt <span class="op">+</span> sigma<span class="op">*</span>np.sqrt(dt)<span class="op">*</span>w <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span>sigma<span class="op">**</span><span class="dv">2</span><span class="op">*</span>(w<span class="op">**</span><span class="dv">2</span><span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>dt )</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> S</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> closed_form(spot, mu, sigma, horizon, timesteps, nsims, seed):</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    np.random.seed(seed)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> horizon<span class="op">/</span>timesteps</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> np.zeros((timesteps,nsims))</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    S[<span class="dv">0</span>] <span class="op">=</span> spot</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, timesteps<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> np.random.standard_normal(nsims)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        S[i<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> S[i]<span class="op">*</span>np.exp( (mu <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span>sigma<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>dt <span class="op">+</span> sigma<span class="op">*</span>w<span class="op">*</span>np.sqrt(dt) )</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> S</span></code></pre></div>
</div>
<div id="3cb0b27e" class="cell markdown">
<h4 id="visualization--validation-of-monte-carlo-sample">Visualization
&amp; validation of Monte Carlo sample</h4>
<p>As a sanity check, the terminal distributions of asset price are
plotted against the theoretical lognormal distribution. The resultant
distribution is regular and high degree of agreement is shown. However,
to further validation the path sampled, a martingale test is done in the
subsequent section. A visualization of the samples is also provided for
reference.</p>
</div>
<div id="df8b11d5" class="cell code" data-execution_count="11">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># path parameters</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>S0<span class="op">=</span><span class="dv">100</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>r<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>D<span class="op">=</span><span class="dv">0</span>  <span class="co"># dividend yield</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>mu<span class="op">=</span>r<span class="op">-</span>D</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>sigma<span class="op">=</span><span class="fl">0.2</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>T<span class="op">=</span><span class="dv">1</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>timesteps<span class="op">=</span><span class="dv">1000</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>nsims_mc<span class="op">=</span><span class="dv">100000</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># contract-specific parameters</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>K<span class="op">=</span><span class="dv">100</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>S<span class="op">=</span>np.zeros((<span class="dv">3</span>,timesteps,nsims_mc))</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>S[<span class="dv">0</span>]<span class="op">=</span>Euler_Maruyama(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>S[<span class="dv">1</span>]<span class="op">=</span>Milstein(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>S[<span class="dv">2</span>]<span class="op">=</span>closed_form(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span></code></pre></div>
</div>
<div id="2ef2bc65" class="cell code" data-execution_count="12">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>phi<span class="op">=</span>np.random.standard_normal(<span class="dv">10000000</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>S_T<span class="op">=</span>S0<span class="op">*</span>np.exp((mu<span class="op">-</span><span class="fl">0.5</span><span class="op">*</span>sigma<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>T<span class="op">+</span>sigma<span class="op">*</span>np.sqrt(T)<span class="op">*</span>phi)</span></code></pre></div>
</div>
<div id="e1e99113" class="cell code" data-execution_count="13">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>label<span class="op">=</span>[<span class="st">&#39;Euler-Maruyama&#39;</span>,<span class="st">&#39;Milstein&#39;</span>,<span class="st">&#39;Theoretical distribution&#39;</span>]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>plt.hist(S_T,histtype<span class="op">=</span><span class="st">&#39;step&#39;</span>,bins<span class="op">=</span><span class="st">&#39;auto&#39;</span>,density<span class="op">=</span><span class="va">True</span>,label<span class="op">=</span>label[<span class="dv">2</span>],color<span class="op">=</span><span class="st">&#39;black&#39;</span>,alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    plt.hist(S[i,<span class="op">-</span><span class="dv">1</span>,:],histtype<span class="op">=</span><span class="st">&#39;step&#39;</span>,bins<span class="op">=</span><span class="st">&#39;auto&#39;</span>,density<span class="op">=</span><span class="va">True</span>,label<span class="op">=</span>label[i])<span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">20</span>,<span class="dv">220</span>))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Probability density&#39;</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r&#39;Asset price at maturity $S_T$&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/8c6831e5192a04b135f84102246bc1a89b2488b8.png" /></p>
</div>
</div>
<div id="41f5cb0b" class="cell code" data-execution_count="17">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>plt.plot(S[<span class="dv">1</span>,:,:<span class="dv">100</span>],alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r&#39;Time steps $i$&#39;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">0</span>,timesteps))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="vs">r&#39;Asset price $S_</span><span class="sc">{t_i}</span><span class="vs">$&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/b57a195ae07cf6231f56fa9926cff1ffb506009f.png" /></p>
</div>
</div>
<div id="11aea6b8" class="cell markdown">
<h5 id="validation-martingale-test">Validation: Martingale test</h5>
<p>Perform the martingale test on the processes <span
class="math inline"><em>S</em>(<em>t</em><sub><em>i</em></sub>)<em>e</em><sup><em>D</em><em>t</em><sub><em>i</em></sub></sup></span>
generated under the two numerical schemes. Martingale property implies
for all <span class="math inline"><em>t</em><sub><em>i</em></sub></span>
<span
class="math display"><em>E</em><sup>ℚ</sup>[<em>e</em><sup>(<em>D</em>−<em>r</em>)<em>t</em><sub><em>i</em></sub></sup><em>S</em>(<em>t</em><sub><em>i</em></sub>)|ℱ<sub>0</sub>] = <em>S</em>(0)</span>
where the <span class="math inline">ℱ<sub>0</sub></span> is the
sigma-algebra at time <span class="math inline"><em>t</em> = 0</span>
such that the expectation is taken with only the information available
at the present. The discounted asset price process is a martingale in
the equivalent-martingale measure <span class="math inline">ℚ</span>. It
needs to be checked how well do the discrete processes preserve the
martingale property.</p>
</div>
<div id="b7a0be2e" class="cell code" data-execution_count="43">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># path parameters</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>S0<span class="op">=</span><span class="dv">100</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>r<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>D<span class="op">=</span><span class="dv">0</span>  <span class="co"># dividend yield</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>mu<span class="op">=</span>r<span class="op">-</span>D</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>sigma<span class="op">=</span><span class="fl">0.2</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>T<span class="op">=</span><span class="dv">1</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>timesteps<span class="op">=</span><span class="dv">252</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>nsims_mc<span class="op">=</span><span class="dv">100000</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># contract-specific parameters</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>K<span class="op">=</span><span class="dv">100</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>S<span class="op">=</span>np.zeros((<span class="dv">3</span>,timesteps,nsims_mc))</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>S[<span class="dv">0</span>]<span class="op">=</span>Euler_Maruyama(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>S[<span class="dv">1</span>]<span class="op">=</span>Milstein(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>S[<span class="dv">2</span>]<span class="op">=</span>closed_form(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span></code></pre></div>
</div>
<div id="bbefd00f" class="cell code" data-execution_count="44">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>discounted<span class="op">=</span>np.zeros((<span class="dv">2</span>,timesteps))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    discounted[i,:]<span class="op">=</span>np.array([(np.exp(<span class="op">-</span>mu<span class="op">*</span>T<span class="op">*</span>(t<span class="op">/</span>timesteps))<span class="op">*</span>S[i,t,:]).mean() <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(timesteps)])</span></code></pre></div>
</div>
<div id="a1d3987a" class="cell code" data-execution_count="45">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>np.arange(<span class="dv">0</span>,timesteps)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="fl">6.4</span>,<span class="fl">4.8</span>),dpi<span class="op">=</span><span class="dv">120</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>label<span class="op">=</span>[<span class="st">&#39;Euler-Maruyama&#39;</span>,<span class="st">&#39;Milstein&#39;</span>]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>plt.plot(x,discounted.T,label<span class="op">=</span>label)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="fl">99.9</span>,<span class="fl">100.1</span>))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="dv">0</span>,timesteps))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Expected discounted asset </span><span class="ch">\n</span><span class="st">&#39;</span><span class="op">+</span><span class="vs">r&#39;price  $E[e^{(D-r)t_i}S(t_i)]$&#39;</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;time-step i&#39;</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Test for martingale property&#39;</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>plt.axhline(S0,color<span class="op">=</span><span class="st">&#39;grey&#39;</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/89ab2d0b1df05582b3bc0efbe2000a8d47c24b44.png" /></p>
</div>
</div>
<div id="a9e73fe9" class="cell markdown">
<p>The curves for Euler-Maruyama and Milstein schemes overlap completely
in above figure. The grey horizon line denotes the level of initial spot
price <span class="math inline"><em>S</em>(0)</span> for comparison. The
expectation values for the discounted process at each time-step fall
within <span class="math inline"> ± 0.05</span>% from the spot price
<span class="math inline"><em>S</em>(0) = 100</span>, and therefore, the
paths generated in both schemes pass the martingale test. This is an
important validation to show that the number of time-steps and number of
Monte-Carlo samples are sufficient for subsequent investigations on
option prices.</p>
</div>
<div id="c48bb002" class="cell markdown">
<h4 id="error-analysis-scaling-laws">Error analysis: scaling laws</h4>
<p>Milstein scheme improves upon Euler-Maruyama by incorporating the
Milstein correction term. However, this is not to say that price
estimates obtained with Milstein scheme must be more accurate than that
of Euler-Maruyama. This is an important distinction and will be
reflected in the subsequent section on price estimates and their error
analysis. Incorporation of higher order terms in the Ito-Taylor
expansion merely implies that as we adopt ever finer discretization
time-step size <span class="math inline"><em>δ</em><em>t</em></span>,
the error in price estimate with Milstein scheme will eventually lie
strictly below that of Euler-Maruyama. This section attempts to find the
scaling of error in the asset price processes generated, by benchmarking
against the closed-form solution.</p>
</div>
<div id="9cf775f4" class="cell code">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># path parameters</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>S0<span class="op">=</span><span class="dv">100</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>r<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>D<span class="op">=</span><span class="dv">0</span>  <span class="co"># dividend yield</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>mu<span class="op">=</span>r<span class="op">-</span>D</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>sigma<span class="op">=</span><span class="fl">0.2</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>T<span class="op">=</span><span class="dv">1</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>timesteps_list<span class="op">=</span>np.array([<span class="dv">512</span>,<span class="dv">1024</span>,<span class="dv">2048</span>,<span class="dv">4096</span>,<span class="dv">8192</span>,<span class="dv">16384</span>])</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>nsims_mc<span class="op">=</span><span class="dv">10000</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># contract-specific parameters</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>K<span class="op">=</span><span class="dv">100</span></span></code></pre></div>
</div>
<div id="00903437" class="cell code">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>err<span class="op">=</span>np.zeros((timesteps_list.size,<span class="dv">2</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,timesteps <span class="kw">in</span> <span class="bu">enumerate</span>(timesteps_list):</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    S<span class="op">=</span>np.zeros((<span class="dv">3</span>,timesteps,nsims_mc))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    S[<span class="dv">0</span>]<span class="op">=</span>Euler_Maruyama(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    S[<span class="dv">1</span>]<span class="op">=</span>Milstein(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    S[<span class="dv">2</span>]<span class="op">=</span>closed_form(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    err[i,<span class="dv">0</span>]<span class="op">=</span>np.sqrt(((S[<span class="dv">0</span>]<span class="op">-</span>S[<span class="dv">2</span>])<span class="op">**</span><span class="dv">2</span>).<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">0</span>).mean())</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    err[i,<span class="dv">1</span>]<span class="op">=</span>np.sqrt(((S[<span class="dv">1</span>]<span class="op">-</span>S[<span class="dv">2</span>])<span class="op">**</span><span class="dv">2</span>).<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">0</span>).mean())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>CPU times: user 18 s, sys: 5.2 s, total: 23.2 s
Wall time: 23.3 s
</code></pre>
</div>
</div>
<div id="659bf4bd" class="cell code">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>m<span class="op">=</span>np.zeros(<span class="dv">2</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>c<span class="op">=</span>np.zeros(<span class="dv">2</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>err[:,i]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>T<span class="op">/</span>timesteps_list</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> error_decay_form(x,m,c):</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> c<span class="op">*</span>x<span class="op">**</span>m</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    (m[i],c[i]),Sigma,info,_,_<span class="op">=</span>curve_fit(error_decay_form,x,y,[<span class="dv">1</span>,<span class="dv">1</span>],full_output<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(m[i],c[i])</span></span></code></pre></div>
</div>
<div id="16669b84" class="cell code">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>T<span class="op">/</span>timesteps_list</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    plt.scatter(x,err[:,i],marker<span class="op">=</span><span class="st">&#39;+&#39;</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">&#39;log&#39;</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>plt.xscale(<span class="st">&#39;log&#39;</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>np.linspace(<span class="fl">0.00004</span>,<span class="fl">0.003</span>,<span class="dv">10000</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span>c[<span class="dv">0</span>]<span class="op">*</span>x<span class="op">**</span>m[<span class="dv">0</span>]</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>plt.plot(x,y,label<span class="op">=</span><span class="vs">rf&#39;Euler-Maruyama slope: </span><span class="sc">{</span>m[<span class="dv">0</span>]<span class="sc">:.5g}</span><span class="vs">&#39;</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span>c[<span class="dv">1</span>]<span class="op">*</span>x<span class="op">**</span>m[<span class="dv">1</span>]</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>plt.plot(x,y,label<span class="op">=</span><span class="vs">rf&#39;Milstein slope: </span><span class="sc">{</span>m[<span class="dv">1</span>]<span class="sc">:.5g}</span><span class="vs">&#39;</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>plt.ylim(bottom<span class="op">=</span><span class="fl">0.00002</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="fl">0.00001</span>,<span class="fl">0.01</span>))</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Error&#39;</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r&#39;Time-step size $\delta t$&#39;</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/b9452cd63d7ee2815ccb6dc0ba53d385097d0c8b.png" /></p>
</div>
</div>
<div id="7ac35095" class="cell markdown">
<p>Define the following error measure [1] for the asset price process
<span
class="math inline"><em>S</em>(<em>t</em><sub><em>i</em></sub>)</span>
generated under some numerical schemes <span
class="math display">$$\text{error}(S)=\sqrt{E\big[\sup_{t_i}[S(t_i)-S^*(t_i)]^2\big]}$$</span>
where <span
class="math inline"><em>S</em><sup>*</sup>(<em>t</em><sub><em>i</em></sub>)</span>
is the theoretical asset price at time <span
class="math inline"><em>t</em><sub><em>i</em></sub></span> , obtained
using the closed-form solution to the geometric Brownian motion SDE.
This error measure is the root-mean-squared error (RMSE) with the
supremum-distance between a pair of asset price paths.</p>
<p>The strong orders of convergence (obtained as "slopes" in above
figure) are measured for the two numerical schemes. The relative error
for these estimates are 1.97% and 1.51% (from the theoretical values of
0.5 and 1 [2]) for the Euler-Maruyama scheme and Milstein scheme
respectively. The figure reflects that not only are the errors in
Milstein scheme strictly less than that of Euler-Maruyama scheme, the
rate at which those errors vanishes with smaller and smaller time-step
size <span class="math inline"><em>δ</em><em>t</em></span> is faster in
Milstein scheme.</p>
<p>Below is a table summarizing the strong convergence orders of the
Euler-Maruyama and Milstein schemes in solving Ito SDEs: <center></p>
<table>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">Euler-Maruyama</th>
<th style="text-align: center;">Milstein</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Theoretical</td>
<td style="text-align: center;">0.5</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td>Monte Carlo</td>
<td style="text-align: center;">0.49016</td>
<td style="text-align: center;">0.98494</td>
</tr>
<tr class="odd">
<td>Relative error</td>
<td style="text-align: center;">1.97%</td>
<td style="text-align: center;">1.51%</td>
</tr>
</tbody>
</table>
</center>
</div>
<div id="bab997aa" class="cell markdown">
<h4 id="price-estimates-and-error-analysis">Price estimates and error
analysis</h4>
<p>Conveniently, the two contracts of concern have exact solutions for
the prices using Black-Scholes equation. The prices determined by
Black=Scholes equation will therefore by used to benchmark the three
numerical schemes</p>
<p>Define <span
class="math display">$$d_2=\frac{\ln(S(0)/K)+(r-D-\frac{1}{2}\sigma^2)T}{\sigma\sqrt{T}}$$</span>
<span class="math display">$$d_1=d_2+\sigma\sqrt{T}$$</span> and let
<span class="math inline"><em>Φ</em></span> denote the cumulative
distribution function (cdf) of a standard normal random variable. The
price of a European call option with strike <span
class="math inline"><em>K</em></span> and maturity <span
class="math inline"><em>T</em></span> is then <span
class="math display"><em>C</em>(0) = <em>S</em>(0)<em>e</em><sup>−<em>D</em><em>T</em></sup><em>Φ</em>(<em>d</em><sub>1</sub>) − <em>K</em><em>e</em><sup>−<em>r</em><em>T</em></sup><em>Φ</em>(<em>d</em>2)</span>
while that for a binary call is <span
class="math display">$$C_B(0)=-\frac{\partial C(0)}{\partial
K}=e^{-rT}\Phi(d_2)$$</span></p>
</div>
<div id="ae8f8f81" class="cell markdown">
<p>After getting a Monte Carlo sample of the underlying, the expected
payoff of the two contracts are evaluated and discounted to obtain the
prices. These price estimates are then compared to the theoretical value
to obtain percentage errors. To obtain the standard error and mean
squared error (MSE), the above process should be repeated for
independent Monte Carlo samples to obtained a distribution of the price
estimates, which proves to be demanding on the computational resources.
Fortunately, the technique of bootstrap resampling [3] exists as an
accurate and non-parametric trick to obtain there error measures. This
is done by sampling with replacement the Monte Carlo sample, and the
resultant distribution is the same as if one had sample again from
population. Code is as follow and a table summarizing the result is
given at the end:</p>
</div>
<div id="1560689e" class="cell code">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_vanilla_price(S_T):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>((S_T<span class="op">-</span>K)<span class="op">*</span>(S_T<span class="op">&gt;</span>K)).mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_binary_price(S_T):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>(S_T<span class="op">&gt;</span>K).astype(<span class="bu">int</span>).mean(axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="1a7dc954" class="cell code">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># path parameters</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>S0<span class="op">=</span><span class="dv">100</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>r<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>D<span class="op">=</span><span class="dv">0</span>  <span class="co"># dividend yield</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>mu<span class="op">=</span>r<span class="op">-</span>D</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>sigma<span class="op">=</span><span class="fl">0.2</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>T<span class="op">=</span><span class="dv">1</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>timesteps<span class="op">=</span><span class="dv">252</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>nsims_mc<span class="op">=</span><span class="dv">100000</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># contract-specific parameters</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>K<span class="op">=</span><span class="dv">100</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># black-scholes</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>d2 <span class="op">=</span> (np.log(S0<span class="op">/</span>K)<span class="op">+</span>(r<span class="op">-</span>D<span class="op">-</span><span class="fl">0.5</span><span class="op">*</span>sigma<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>T) <span class="op">/</span> (sigma<span class="op">*</span>np.sqrt(T))</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>d1 <span class="op">=</span> d2<span class="op">+</span>sigma<span class="op">*</span>np.sqrt(T)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>vanilla_black_scholes <span class="op">=</span> S0<span class="op">*</span>np.exp(<span class="op">-</span>D<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d1)<span class="op">-</span>K<span class="op">*</span>np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d2)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>binary_black_scholes  <span class="op">=</span> np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d2)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>S<span class="op">=</span>np.zeros((<span class="dv">3</span>,timesteps,nsims_mc))</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>S[<span class="dv">0</span>]<span class="op">=</span>Euler_Maruyama(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>S[<span class="dv">1</span>]<span class="op">=</span>Milstein(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>S[<span class="dv">2</span>]<span class="op">=</span>closed_form(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span></code></pre></div>
</div>
<div id="0ea9c17a" class="cell code">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Black-Scholes prices: &#39;</span>,vanilla_black_scholes,binary_black_scholes)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Black-Scholes prices:  10.450583572185565 0.5323248154537634
</code></pre>
</div>
</div>
<div id="2edbedc1" class="cell code">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>prices<span class="op">=</span>np.zeros((<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>prices[<span class="dv">0</span>,:]<span class="op">=</span>np.array([(np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>((S[i,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">-</span>K)<span class="op">*</span>(S[i,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">&gt;</span>K).astype(<span class="bu">int</span>))).mean() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)])</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>prices[<span class="dv">1</span>,:]<span class="op">=</span>np.array([(np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>((S[i,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">&gt;</span>K).astype(<span class="bu">int</span>))).mean() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)])</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>perc_error<span class="op">=</span>np.zeros((<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>perc_error[<span class="dv">0</span>,:]<span class="op">=</span><span class="bu">abs</span>(prices[<span class="dv">0</span>,:]<span class="op">-</span>vanilla_black_scholes)<span class="op">/</span>vanilla_black_scholes<span class="op">*</span><span class="dv">100</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>perc_error[<span class="dv">1</span>,:]<span class="op">=</span><span class="bu">abs</span>(prices[<span class="dv">1</span>,:]<span class="op">-</span>binary_black_scholes)<span class="op">/</span>binary_black_scholes<span class="op">*</span><span class="dv">100</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Price estimates: &#39;</span>,prices,<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;and their percentage errors: &#39;</span>,perc_error)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Price estimates:  [[10.39979512 10.39859212 10.40038773]
 [ 0.53207018  0.53211774  0.53207018]] 

and their percentage errors:  [[0.48598676 0.49749803 0.48031613]
 [0.04783487 0.03890019 0.04783487]]
</code></pre>
</div>
</div>
<div id="8d8cb5af" class="cell markdown">
<p>Bootsampling of the standard error &amp; mean square error:</p>
</div>
<div id="e947a6e6" class="cell code">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>n_bootstrap<span class="op">=</span><span class="dv">10000</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>distribution<span class="op">=</span>np.zeros((n_bootstrap,<span class="dv">3</span>,<span class="dv">2</span>))  <span class="co"># axes: bootstrap samples, schemes, calls</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>distribution[:,:,<span class="dv">0</span>]<span class="op">=</span>np.array([get_vanilla_price(S[:,<span class="op">-</span><span class="dv">1</span>,np.random.randint(<span class="dv">0</span>,nsims_mc,size<span class="op">=</span>nsims_mc)]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_bootstrap)])</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>distribution[:,:,<span class="dv">1</span>]<span class="op">=</span>np.array([get_binary_price(S[:,<span class="op">-</span><span class="dv">1</span>,np.random.randint(<span class="dv">0</span>,nsims_mc,size<span class="op">=</span>nsims_mc)]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_bootstrap)])</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Bootstrap resampled mean (should agree with the Monte Carlo sample</span><span class="ch">\&#39;</span><span class="st">s mean): &#39;</span>,distribution.mean(axis<span class="op">=</span><span class="dv">0</span>).T)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Bootstrap resampled mean (should agree with the Monte Carlo sample&#39;s mean):  [[10.39958027 10.39837575 10.40017136]
 [ 0.53207789  0.53212309  0.53207572]]
</code></pre>
</div>
</div>
<div id="0b586d23" class="cell code">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>standard_error<span class="op">=</span><span class="dv">1</span><span class="op">/</span>np.sqrt(n_bootstrap)<span class="op">*</span>distribution.std(ddof<span class="op">=</span><span class="dv">1</span>,axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Bootstrap resampled standard error: &#39;</span>,standard_error.T)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Bootstrap resampled standard error:  [[4.57716389e-04 4.57855669e-04 4.57952943e-04]
 [1.49061276e-05 1.48990617e-05 1.48968140e-05]]
</code></pre>
</div>
</div>
<div id="317cdf66" class="cell code">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>MSE<span class="op">=</span>np.zeros((<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>MSE[:,<span class="dv">0</span>]<span class="op">=</span>((distribution[:,:,<span class="dv">0</span>]<span class="op">-</span>vanilla_black_scholes)<span class="op">**</span><span class="dv">2</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>MSE[:,<span class="dv">1</span>]<span class="op">=</span>((distribution[:,:,<span class="dv">1</span>]<span class="op">-</span>binary_black_scholes)<span class="op">**</span><span class="dv">2</span>).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Mean squared error: &#39;</span>,MSE.T)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Mean squared error:  [[4.69617047e-03 4.82176499e-03 4.63839041e-03]
 [2.28267770e-06 2.26029013e-06 2.28097849e-06]]
</code></pre>
</div>
</div>
<div id="b0e25062" class="cell code">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span>distribution[:,:,<span class="dv">0</span>]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>label<span class="op">=</span>[<span class="st">&#39;Euler-Maruyama&#39;</span>,<span class="st">&#39;Milstein&#39;</span>,<span class="st">&#39;Closed-form&#39;</span>]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>plt.hist(y,histtype<span class="op">=</span><span class="st">&#39;step&#39;</span>,bins<span class="op">=</span><span class="st">&#39;auto&#39;</span>,density<span class="op">=</span><span class="va">True</span>,label<span class="op">=</span>label)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>plt.axvline(vanilla_black_scholes,color<span class="op">=</span><span class="st">&#39;grey&#39;</span>,alpha<span class="op">=</span><span class="fl">0.7</span>,label<span class="op">=</span><span class="st">&#39;Black-Scholes&#39;</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Probability density&#39;</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r&#39;European call price $C(0)$&#39;</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/90fa8bd768942e3b0932eec52490e4b780345b0c.png" /></p>
</div>
</div>
<div id="8294ffef" class="cell code">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>y<span class="op">=</span>distribution[:,:,<span class="dv">1</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>label<span class="op">=</span>[<span class="st">&#39;Euler-Maruyama&#39;</span>,<span class="st">&#39;Milstein&#39;</span>,<span class="st">&#39;Closed-form&#39;</span>]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>plt.hist(y,histtype<span class="op">=</span><span class="st">&#39;step&#39;</span>,bins<span class="op">=</span><span class="st">&#39;auto&#39;</span>,density<span class="op">=</span><span class="va">True</span>,label<span class="op">=</span>label)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>plt.axvline(binary_black_scholes,color<span class="op">=</span><span class="st">&#39;grey&#39;</span>,alpha<span class="op">=</span><span class="fl">0.7</span>,label<span class="op">=</span><span class="st">&#39;Black-Scholes&#39;</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Probability density&#39;</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r&#39;Binary call price $C_B(0)$&#39;</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/d23a5b30e641a2b656de9b95c8fc04e2307ceeba.png" /></p>
</div>
</div>
<div id="417fe0f3" class="cell markdown">
<p>Above figures show the two distributions of price estimate for
obtaining the standard error and mean squared error. Below are tables
summarizing Monte Carlo price estimates for the European call option
using asset price processes generated by 1. Euler-Maruyama scheme, 2.
Milstein scheme, and 3. the closed-form solution respectively.
<center></p>
<table>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">Euler-Maruyama</th>
<th style="text-align: center;">Milstein</th>
<th style="text-align: center;">Closed-form</th>
<th style="text-align: center;">Black-Scholes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>European call price</td>
<td style="text-align: center;">10.3998</td>
<td style="text-align: center;">10.3986</td>
<td style="text-align: center;">10.4004</td>
<td style="text-align: center;">10.4506</td>
</tr>
<tr class="even">
<td>Percent error</td>
<td style="text-align: center;">0.4860%</td>
<td style="text-align: center;">0.4975%</td>
<td style="text-align: center;">0.4803%</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td>Standard error (precision)</td>
<td style="text-align: center;">5e-4</td>
<td style="text-align: center;">5e-4</td>
<td style="text-align: center;">5e-4</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td>Mean squared error (precision)</td>
<td style="text-align: center;">4.696e-03</td>
<td style="text-align: center;">4.822e-03</td>
<td style="text-align: center;">4.639e-03</td>
<td style="text-align: center;">-</td>
</tr>
</tbody>
</table>
<p><strong>Table showing errors in pricing European calls</strong>
</center> <center></p>
<table>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">Euler-Maruyama</th>
<th style="text-align: center;">Milstein</th>
<th style="text-align: center;">Closed-form</th>
<th style="text-align: center;">Black-Scholes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Binary call price</td>
<td style="text-align: center;">0.5321</td>
<td style="text-align: center;">0.5321</td>
<td style="text-align: center;">0.5321</td>
<td style="text-align: center;">0.5323</td>
</tr>
<tr class="even">
<td>Percent error</td>
<td style="text-align: center;">0.04783%</td>
<td style="text-align: center;">0.03890%</td>
<td style="text-align: center;">0.04783%</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="odd">
<td>Standard error (precision)</td>
<td style="text-align: center;">1e-5</td>
<td style="text-align: center;">1e-5</td>
<td style="text-align: center;">1e-5</td>
<td style="text-align: center;">-</td>
</tr>
<tr class="even">
<td>Mean squared error (accuracy)</td>
<td style="text-align: center;">2.283e-06</td>
<td style="text-align: center;">2.260e-06</td>
<td style="text-align: center;">2.281e-06</td>
<td style="text-align: center;">-</td>
</tr>
</tbody>
</table>
<p><strong>Table showing errors in pricing binary calls</strong>
</center></p>
<p>All error measures are extremely small (effectively zero) and
therefore the conclusion that any one is larger than another should not
be made. As alluded to in the section "Error analysis: scaling laws", it
cannot be observed that price estimates obtained under Milstein scheme
is more accurate than those from Euler-Maruyama scheme. The same can be
said for the closed-form solution and Milstein scheme. This is an
interesting observation and reflects that including higher order terms
in the Ito-Taylor expansion into a discretization scheme does not
guarantee more accurate price estimates. What is guarantee for such a
scheme is rather that its error vanishes at a faster rate as <span
class="math inline"><em>δ</em><em>t</em> → 0</span>. This observation
motivates the section "Error analysis: scaling laws" for uncovering the
strong order of convergence in the stock price.</p>
<p>The same random seed is used for pricing both options, and it is
observed that the binary call is priced with higher accuracy and
precision.</p>
</div>
<div id="23127634" class="cell markdown">
<h5 id="error-analysis-over-a-range-of-strike-and-maturity">Error
analysis over a range of strike and maturity</h5>
<p>In the above error analysis, particular values for the model
parameters are chosen. This section investigates the price and error of
the two options over the strike-maturity plane. The next section fixes
the strike and maturity again and instead turn to the price and error at
all combination of volatility levels and dividend yields. To first this
section, we relax strike to a range of value and fix the maturity.</p>
<p>Define the squared error as the squared different between the price
estimate and the theoretical price determined by Black-Scholes equation.
It is curious that the error for European call is maximal when the
strike is at the current spot price <span
class="math inline"><em>S</em>(0)</span>. The squared error converges to
a small nonzero value when the strike decreases from there, and the
error vanishes when the strike tends to infinity.</p>
<p>In constrast, the squared error for binary call is at a minimum when
the strike is at the spot price <span
class="math inline"><em>S</em>(0)</span>. More structure can be reveal
when we look at the residual (see the figure below), defined as <span
class="math display"><em>r</em><em>e</em><em>s</em><em>i</em><em>d</em><em>u</em><em>a</em><em>l</em> = <em>p</em><em>r</em><em>e</em><em>d</em><em>i</em><em>c</em><em>t</em><em>e</em><em>d</em> <em>v</em><em>a</em><em>l</em><em>u</em><em>e</em> − <em>t</em><em>h</em><em>e</em><em>o</em><em>r</em><em>e</em><em>t</em><em>i</em><em>c</em><em>a</em><em>l</em> <em>v</em><em>a</em><em>l</em><em>u</em><em>e</em></span>
The residuals for the predicted binary call price for all numerical
schemes take on opposite signs for strike prices to the left or right of
the spot price. The residual varies continuously with the strike and is
approximately zero when the strike equals the spot price, as long as the
number of Monte Carlo samples is sufficient. As the square error
converges to zero when the strike moves away from the spot price.</p>
<p>Notice also that the squared error is significantly smaller for
binary call price estimates compared to European call price
estimates.</p>
</div>
<div id="a510acfb" class="cell code">
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># path parameters</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>S0<span class="op">=</span><span class="dv">100</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>r<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>D<span class="op">=</span><span class="dv">0</span>  <span class="co"># dividend yield</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>mu<span class="op">=</span>r<span class="op">-</span>D</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>sigma<span class="op">=</span><span class="fl">0.2</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>T<span class="op">=</span><span class="dv">1</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>timesteps<span class="op">=</span><span class="dv">20</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>nsims_mc<span class="op">=</span><span class="dv">1000000</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>S<span class="op">=</span>np.zeros((<span class="dv">3</span>,timesteps,nsims_mc))</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>S[<span class="dv">0</span>]<span class="op">=</span>Euler_Maruyama(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>S[<span class="dv">1</span>]<span class="op">=</span>Milstein(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>S[<span class="dv">2</span>]<span class="op">=</span>closed_form(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># contract-specific parameters</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>Ks<span class="op">=</span>np.linspace(<span class="dv">0</span>,<span class="dv">250</span>,<span class="dv">1000</span>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>vanilla<span class="op">=</span>np.zeros(Ks.size)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>binary<span class="op">=</span>np.zeros(Ks.size)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>prices<span class="op">=</span>np.zeros((Ks.size,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,K <span class="kw">in</span> <span class="bu">enumerate</span>(Ks):</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># black-scholes</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> (np.log(S0<span class="op">/</span>K)<span class="op">+</span>(r<span class="op">-</span>D<span class="op">-</span><span class="fl">0.5</span><span class="op">*</span>sigma<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>T) <span class="op">/</span> (sigma<span class="op">*</span>np.sqrt(T))</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> d2<span class="op">+</span>sigma<span class="op">*</span>np.sqrt(T)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    vanilla[i] <span class="op">=</span> S0<span class="op">*</span>np.exp(<span class="op">-</span>D<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d1)<span class="op">-</span>K<span class="op">*</span>np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d2)</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    binary[i]  <span class="op">=</span> np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d2)</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    prices[i,<span class="dv">0</span>,:]<span class="op">=</span>np.array([(np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>((S[i,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">-</span>K)<span class="op">*</span>(S[i,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">&gt;</span>K).astype(<span class="bu">int</span>))).mean() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)])</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>    prices[i,<span class="dv">1</span>,:]<span class="op">=</span>np.array([(np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>((S[i,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">&gt;</span>K).astype(<span class="bu">int</span>))).mean() <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)])</span></code></pre></div>
<div class="output stream stderr">
<pre><code>/tmp/ipykernel_1327/3953040706.py:24: RuntimeWarning: divide by zero encountered in scalar divide
  d2 = (np.log(S0/K)+(r-D-0.5*sigma**2)*T) / (sigma*np.sqrt(T))
</code></pre>
</div>
</div>
<div id="a3f6d047" class="cell code">
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">5</span>),dpi<span class="op">=</span><span class="dv">120</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(wspace<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>label<span class="op">=</span>[<span class="st">&#39;Euler-Maruyama&#39;</span>,<span class="st">&#39;Milstein&#39;</span>,<span class="st">&#39;Closed-form&#39;</span>]</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(Ks,prices[:,<span class="dv">0</span>,:],label<span class="op">=</span>label)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(Ks,vanilla,label<span class="op">=</span><span class="st">&#39;Black-Scholes&#39;</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].legend()</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="vs">r&#39;European call price $C(0)$&#39;</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="vs">r&#39;Strike $K$&#39;</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    plt.plot(Ks,(prices[:,<span class="dv">0</span>,i]<span class="op">-</span>vanilla)<span class="op">**</span><span class="dv">2</span>,label<span class="op">=</span>label[i])</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].legend()</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">&#39;Squared error&#39;</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="vs">r&#39;Strike $K$&#39;</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].axvline(S0,color<span class="op">=</span><span class="st">&#39;grey&#39;</span>,alpha<span class="op">=</span><span class="fl">0.8</span>,linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/4805ca15c04dfc7b469e87feeb51dbce6ff44dbc.png" /></p>
</div>
</div>
<div id="68dd2e2b" class="cell code">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">5</span>),dpi<span class="op">=</span><span class="dv">120</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(wspace<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>label<span class="op">=</span>[<span class="st">&#39;Euler-Maruyama&#39;</span>,<span class="st">&#39;Milstein&#39;</span>,<span class="st">&#39;Closed-form&#39;</span>]</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(Ks,prices[:,<span class="dv">1</span>,:],label<span class="op">=</span>label)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(Ks,binary,label<span class="op">=</span><span class="st">&#39;Black-Scholes&#39;</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].legend()</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="vs">r&#39;Binary call price $C_B(0)$&#39;</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="vs">r&#39;Strike $K$&#39;</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    plt.plot(Ks,(prices[:,<span class="dv">1</span>,i]<span class="op">-</span>binary),label<span class="op">=</span>label[i])</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].legend()</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">&#39;Residuals&#39;</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="vs">r&#39;Strike $K$&#39;</span>)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].axvline(S0,color<span class="op">=</span><span class="st">&#39;grey&#39;</span>,alpha<span class="op">=</span><span class="fl">0.8</span>,linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/0ac37db522a08b403fb342933a67f493ff5cd544.png" /></p>
</div>
</div>
<div id="d62e7529" class="cell markdown">
<p>Relaxing maturity:</p>
<p>We now show the same pattern across a range of maturity. In the below
figure, the estimate generated by the three estimated greatly overlap
with each other and will be colored with the same color. The price
surface obtained from Black-Scholes is plotted as a black wirefame for
comparison with the estimates.</p>
</div>
<div id="ab58ec3c" class="cell code">
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># path parameters</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>S0<span class="op">=</span><span class="dv">100</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>r<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>D<span class="op">=</span><span class="dv">0</span> <span class="co"># dividend yield</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>mu<span class="op">=</span>r<span class="op">-</span>D</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>sigma<span class="op">=</span><span class="fl">0.2</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>Ts<span class="op">=</span>np.linspace(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">100</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>timesteps<span class="op">=</span><span class="dv">20</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>nsims_mc<span class="op">=</span><span class="dv">100000</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co"># contract-specific parameters</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>Ks<span class="op">=</span>np.linspace(<span class="dv">0</span>,<span class="dv">250</span>,<span class="dv">100</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>vanilla<span class="op">=</span>np.zeros((Ds.size,Ks.size))</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>binary<span class="op">=</span>np.zeros((Ds.size,Ks.size))</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>prices<span class="op">=</span>np.zeros((Ds.size,Ks.size,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,T <span class="kw">in</span> <span class="bu">enumerate</span>(Ts):</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j,K <span class="kw">in</span> <span class="bu">enumerate</span>(Ks):</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># black-scholes</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        d2 <span class="op">=</span> (np.log(S0<span class="op">/</span>K)<span class="op">+</span>(r<span class="op">-</span>D<span class="op">-</span><span class="fl">0.5</span><span class="op">*</span>sigma<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>T) <span class="op">/</span> (sigma<span class="op">*</span>np.sqrt(T))</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>        d1 <span class="op">=</span> d2<span class="op">+</span>sigma<span class="op">*</span>np.sqrt(T)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>        vanilla[i,j] <span class="op">=</span> S0<span class="op">*</span>np.exp(<span class="op">-</span>D<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d1)<span class="op">-</span>K<span class="op">*</span>np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d2)</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        binary[i,j]  <span class="op">=</span> np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d2)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>        S<span class="op">=</span>np.zeros((<span class="dv">3</span>,timesteps,nsims_mc))</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>        S[<span class="dv">0</span>]<span class="op">=</span>Euler_Maruyama(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>        S[<span class="dv">1</span>]<span class="op">=</span>Milstein(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>        S[<span class="dv">2</span>]<span class="op">=</span>closed_form(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>        prices[i,j,<span class="dv">0</span>,:]<span class="op">=</span>np.array([(np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>((S[k,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">-</span>K)<span class="op">*</span>(S[k,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">&gt;</span>K).astype(<span class="bu">int</span>))).mean() <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)])</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>        prices[i,j,<span class="dv">1</span>,:]<span class="op">=</span>np.array([(np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>((S[k,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">&gt;</span>K).astype(<span class="bu">int</span>))).mean() <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)])</span></code></pre></div>
<div class="output stream stderr">
<pre><code>/tmp/ipykernel_1327/4186235011.py:22: RuntimeWarning: divide by zero encountered in scalar divide
  d2 = (np.log(S0/K)+(r-D-0.5*sigma**2)*T) / (sigma*np.sqrt(T))
</code></pre>
</div>
</div>
<div id="0c776312" class="cell code">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;data/Prices over maturity and strike for error analysis.pickle&#39;</span>,<span class="st">&#39;bw&#39;</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    pickle.dump((vanilla,binary,prices),<span class="bu">file</span>)</span></code></pre></div>
</div>
<div id="81abb5fc" class="cell code">
<div class="sourceCode" id="cb37"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;data/Prices over maturity and strike for error analysis.pickle&#39;</span>,<span class="st">&#39;br&#39;</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    (vanilla,binary,prices)<span class="op">=</span>pickle.load(<span class="bu">file</span>)</span></code></pre></div>
</div>
<div id="a06290d9" class="cell code">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(subplot_kw<span class="op">=</span>{<span class="st">&quot;projection&quot;</span>: <span class="st">&quot;3d&quot;</span>},figsize<span class="op">=</span>(<span class="fl">6.4</span><span class="op">*</span><span class="fl">1.5</span>,<span class="fl">4.8</span><span class="op">*</span><span class="fl">1.5</span>))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>X,Y<span class="op">=</span>np.meshgrid(Ts,Ks)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>f<span class="op">=</span>vanilla</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>surf <span class="op">=</span> ax.plot_wireframe(X, Y, f.T, color<span class="op">=</span><span class="st">&#39;Black&#39;</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                    linewidth<span class="op">=</span><span class="dv">1</span>, antialiased<span class="op">=</span><span class="va">False</span>,rstride<span class="op">=</span><span class="dv">10</span>, cstride<span class="op">=</span><span class="dv">10</span>,label<span class="op">=</span><span class="st">&#39;Black-Scholes&#39;</span>)  <span class="co"># f.transposed because plot has reversed axes order</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    f<span class="op">=</span>prices[:,:,<span class="dv">0</span>,i]</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    surf <span class="op">=</span> ax.plot_surface(X, Y, f.T, cmap<span class="op">=</span>cm.RdBu,alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                        linewidth<span class="op">=</span><span class="dv">0</span>, antialiased<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the z axis.</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_locator(LinearLocator(<span class="dv">10</span>))</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_formatter(<span class="st">&#39;</span><span class="sc">{x:.02f}</span><span class="st">&#39;</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a color bar which maps values to colors.</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>fig.colorbar(surf, shrink<span class="op">=</span><span class="fl">0.7</span>,pad<span class="op">=</span><span class="fl">0.07</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r&#39;Strike $K$&#39;</span>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="vs">r&#39;Time to maturity $T$&#39;</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="vs">r&#39;European call price $C(0)$&#39;</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>ax.view_init(<span class="dv">20</span>, <span class="dv">160</span>)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/ab4c279f8fc55d49a9e15763a001251d0198a187.png" /></p>
</div>
</div>
<div id="59ab0ed6" class="cell code">
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>X,Y<span class="op">=</span>np.meshgrid(Ts,Ks)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(subplot_kw<span class="op">=</span>{<span class="st">&quot;projection&quot;</span>: <span class="st">&quot;3d&quot;</span>},figsize<span class="op">=</span>(<span class="fl">6.4</span><span class="op">*</span><span class="fl">1.5</span>,<span class="fl">4.8</span><span class="op">*</span><span class="fl">1.5</span>))</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    f<span class="op">=</span>(prices[:,:,<span class="dv">0</span>,i]<span class="op">-</span>vanilla)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    surf <span class="op">=</span> ax.plot_surface(X, Y, f.T, cmap<span class="op">=</span>cm.RdBu,alpha<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>                        linewidth<span class="op">=</span><span class="dv">0</span>, antialiased<span class="op">=</span><span class="va">False</span>)  <span class="co"># f.transposed because plot has reversed axes order</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the z axis.</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_locator(LinearLocator(<span class="dv">10</span>))</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_formatter(<span class="st">&#39;</span><span class="sc">{x:.02f}</span><span class="st">&#39;</span>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_title(&#39; &#39;*115)</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a color bar which maps values to colors.</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>fig.colorbar(surf, shrink<span class="op">=</span><span class="fl">0.7</span>,pad<span class="op">=</span><span class="fl">0.07</span>)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r&#39;Strike $K$&#39;</span>)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="vs">r&#39;Maturity $T$&#39;</span>)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="vs">r&#39;Squared error in European call price&#39;</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>ax.view_init(<span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>ax.view_init(<span class="dv">20</span>, <span class="dv">160</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/d87583a739112945f6c63beaa44958dba2bd0669.png" /></p>
</div>
</div>
<div id="c464c4de" class="cell code">
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(subplot_kw<span class="op">=</span>{<span class="st">&quot;projection&quot;</span>: <span class="st">&quot;3d&quot;</span>},figsize<span class="op">=</span>(<span class="fl">6.4</span><span class="op">*</span><span class="fl">1.5</span>,<span class="fl">4.8</span><span class="op">*</span><span class="fl">1.5</span>))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>X,Y<span class="op">=</span>np.meshgrid(Ts,Ks)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>f<span class="op">=</span>binary</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>surf <span class="op">=</span> ax.plot_wireframe(X, Y, f.T, color<span class="op">=</span><span class="st">&#39;Black&#39;</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>                    linewidth<span class="op">=</span><span class="dv">1</span>, antialiased<span class="op">=</span><span class="va">False</span>,rstride<span class="op">=</span><span class="dv">10</span>, cstride<span class="op">=</span><span class="dv">10</span>,label<span class="op">=</span><span class="st">&#39;Black-Scholes&#39;</span>)  <span class="co"># f.transposed because plot has reversed axes order</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    f<span class="op">=</span>prices[:,:,<span class="dv">1</span>,i]</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    surf <span class="op">=</span> ax.plot_surface(X, Y, f.T, cmap<span class="op">=</span>cm.RdBu,alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>                        linewidth<span class="op">=</span><span class="dv">0</span>, antialiased<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the z axis.</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_locator(LinearLocator(<span class="dv">10</span>))</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_formatter(<span class="st">&#39;</span><span class="sc">{x:.02f}</span><span class="st">&#39;</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a color bar which maps values to colors.</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>fig.colorbar(surf, shrink<span class="op">=</span><span class="fl">0.7</span>,pad<span class="op">=</span><span class="fl">0.07</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r&#39;Strike $K$&#39;</span>)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="vs">r&#39;Time to maturity $T$&#39;</span>)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="vs">r&#39;Binary call price $C_B(0)$&#39;</span>)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>ax.view_init(<span class="dv">20</span>, <span class="dv">160</span>)</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/a9b8cb6fbf1f9b237e5ea1d23356c03d942404cf.png" /></p>
</div>
</div>
<div id="10729847" class="cell code">
<div class="sourceCode" id="cb41"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>X,Y<span class="op">=</span>np.meshgrid(Ts,Ks)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(subplot_kw<span class="op">=</span>{<span class="st">&quot;projection&quot;</span>: <span class="st">&quot;3d&quot;</span>},figsize<span class="op">=</span>(<span class="fl">6.4</span><span class="op">*</span><span class="fl">1.5</span>,<span class="fl">4.8</span><span class="op">*</span><span class="fl">1.5</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    f<span class="op">=</span>(prices[:,:,<span class="dv">1</span>,i]<span class="op">-</span>binary)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    surf <span class="op">=</span> ax.plot_surface(X, Y, f.T, cmap<span class="op">=</span>cm.RdBu,alpha<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                        linewidth<span class="op">=</span><span class="dv">0</span>, antialiased<span class="op">=</span><span class="va">False</span>)  <span class="co"># f.transposed because plot has reversed axes order</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the z axis.</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_locator(LinearLocator(<span class="dv">10</span>))</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_formatter(<span class="st">&#39;</span><span class="sc">{x:.02f}</span><span class="st">&#39;</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_title(&#39; &#39;*115)</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a color bar which maps values to colors.</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>fig.colorbar(surf, shrink<span class="op">=</span><span class="fl">0.7</span>,pad<span class="op">=</span><span class="fl">0.07</span>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r&#39;Strike $K$&#39;</span>)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="vs">r&#39;Maturity $T$&#39;</span>)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="vs">r&#39;Squared error in binary call prices&#39;</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>ax.view_init(<span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>ax.view_init(<span class="dv">20</span>, <span class="dv">160</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/d38506eaff5045a0a8fa57a7a9799130951e8e08.png" /></p>
</div>
</div>
<div id="977aa044" class="cell code">
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>X,Y<span class="op">=</span>np.meshgrid(Ts,Ks)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(subplot_kw<span class="op">=</span>{<span class="st">&quot;projection&quot;</span>: <span class="st">&quot;3d&quot;</span>},figsize<span class="op">=</span>(<span class="fl">6.4</span><span class="op">*</span><span class="fl">1.5</span>,<span class="fl">4.8</span><span class="op">*</span><span class="fl">1.5</span>))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    f<span class="op">=</span>(prices[:,:,<span class="dv">1</span>,i]<span class="op">-</span>binary)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    surf <span class="op">=</span> ax.plot_surface(X, Y, f.T, cmap<span class="op">=</span>cm.RdBu,alpha<span class="op">=</span><span class="fl">0.6</span>,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                        linewidth<span class="op">=</span><span class="dv">0</span>, antialiased<span class="op">=</span><span class="va">False</span>)  <span class="co"># f.transposed because plot has reversed axes order</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the z axis.</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_locator(LinearLocator(<span class="dv">10</span>))</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_formatter(<span class="st">&#39;</span><span class="sc">{x:.02f}</span><span class="st">&#39;</span>)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_title(&#39; &#39;*115)</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a color bar which maps values to colors.</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>fig.colorbar(surf, shrink<span class="op">=</span><span class="fl">0.7</span>,pad<span class="op">=</span><span class="fl">0.07</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r&#39;Strike $K$&#39;</span>)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="vs">r&#39;Maturity $T$&#39;</span>)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="vs">r&#39;Residuals of binary call prices&#39;</span>)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>ax.view_init(<span class="dv">10</span>, <span class="dv">10</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/bc7ed1136c4297a834a788237bfdd9d5cef6829d.png" /></p>
</div>
</div>
<div id="e59176e2" class="cell markdown">
<p>For both call options, the squared error decreases with increasing
time to maturity. It is observed for a range of maturity that the
maximum error is obtained near the spot price for European calls. The
squared error for binary calls price estimates across all numerical
schemes are large only for strike prices around the spot price, but as
reflected in the residual plot, the squared error should decrease
sharply for values of the strike price that roughly equal the spot
price.</p>
</div>
<div id="c7590e3c" class="cell markdown">
<h5
id="error-analysis-over-a-range-of-volatility-and-dividend-yield">Error
analysis over a range of volatility and dividend yield</h5>
<p>The above analysis is repeated, but with a range of values for
volatility and dividend yield indead. The below two figures for the two
options reflect that an increase in volatility greatly increase the
error for Monte Carlo pricing of European calls, but not for binary
calls. It can be seen that the error for binary calls stay really small
across all levels of volatility.</p>
<p>In terms of the option prices, whether it increases with increasing
volatility depends on the dividend yield, as will be revealed
shortly.</p>
</div>
<div id="db728e8d" class="cell code">
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># path parameters</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>S0<span class="op">=</span><span class="dv">100</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>r<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>D<span class="op">=</span><span class="dv">0</span>  <span class="co"># dividend yield</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>mu<span class="op">=</span>r<span class="op">-</span>D</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>sigmas<span class="op">=</span>np.linspace(<span class="dv">0</span>,<span class="fl">0.8</span>,<span class="dv">100</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>T<span class="op">=</span><span class="dv">1</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>timesteps<span class="op">=</span><span class="dv">252</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>nsims_mc<span class="op">=</span><span class="dv">10000</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># contract-specific parameters</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>K<span class="op">=</span><span class="dv">100</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>vanilla<span class="op">=</span>np.zeros(sigmas.size)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>binary<span class="op">=</span>np.zeros(sigmas.size)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>prices<span class="op">=</span>np.zeros((sigmas.size,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,sigma <span class="kw">in</span> <span class="bu">enumerate</span>(sigmas):</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># black-scholes</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> (np.log(S0<span class="op">/</span>K)<span class="op">+</span>(r<span class="op">-</span>D<span class="op">-</span><span class="fl">0.5</span><span class="op">*</span>sigma<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>T) <span class="op">/</span> (sigma<span class="op">*</span>np.sqrt(T))</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> d2<span class="op">+</span>sigma<span class="op">*</span>np.sqrt(T)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    vanilla[i] <span class="op">=</span> S0<span class="op">*</span>np.exp(<span class="op">-</span>D<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d1)<span class="op">-</span>K<span class="op">*</span>np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d2)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    binary[i]  <span class="op">=</span> np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d2)</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    S<span class="op">=</span>np.zeros((<span class="dv">3</span>,timesteps,nsims_mc))</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    S[<span class="dv">0</span>]<span class="op">=</span>Euler_Maruyama(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>    S[<span class="dv">1</span>]<span class="op">=</span>Milstein(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>    S[<span class="dv">2</span>]<span class="op">=</span>closed_form(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>    prices[i,<span class="dv">0</span>,:]<span class="op">=</span>np.array([(np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>((S[j,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">-</span>K)<span class="op">*</span>(S[j,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">&gt;</span>K).astype(<span class="bu">int</span>))).mean() <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)])</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>    prices[i,<span class="dv">1</span>,:]<span class="op">=</span>np.array([(np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>((S[j,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">&gt;</span>K).astype(<span class="bu">int</span>))).mean() <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)])</span></code></pre></div>
<div class="output stream stderr">
<pre><code>/tmp/ipykernel_1327/382577550.py:19: RuntimeWarning: divide by zero encountered in scalar divide
  d2 = (np.log(S0/K)+(r-D-0.5*sigma**2)*T) / (sigma*np.sqrt(T))
</code></pre>
</div>
</div>
<div id="220bc247" class="cell code">
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">11</span>,<span class="dv">5</span>),dpi<span class="op">=</span><span class="dv">120</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(wspace<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>label<span class="op">=</span>[<span class="st">&#39;Euler-Maruyama&#39;</span>,<span class="st">&#39;Milstein&#39;</span>,<span class="st">&#39;Closed-form&#39;</span>]</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>linestyle<span class="op">=</span>[<span class="st">&#39;-&#39;</span>,<span class="st">&#39;-&#39;</span>,<span class="st">&#39;:&#39;</span>]</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].plot(sigmas,prices[:,<span class="dv">0</span>,i],label<span class="op">=</span>label[i],linestyle<span class="op">=</span>linestyle[i])</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(sigmas,vanilla,label<span class="op">=</span><span class="st">&#39;Black-Scholes&#39;</span>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].legend()</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="vs">r&#39;European call price $C(0)$&#39;</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="vs">r&#39;Volatility $\sigma$&#39;</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylim(bottom<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>linestyle<span class="op">=</span>[<span class="st">&#39;-&#39;</span>,<span class="st">&#39;-&#39;</span>,<span class="st">&#39;:&#39;</span>]</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    plt.plot(sigmas,(prices[:,<span class="dv">0</span>,i]<span class="op">-</span>vanilla)<span class="op">**</span><span class="dv">2</span>,label<span class="op">=</span>label[i],linestyle<span class="op">=</span>linestyle[i])</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylim(bottom<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].legend()</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">&#39;Squared error&#39;</span>)</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="vs">r&#39;Volatility $\sigma$&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/029fbf0edc6f4aa09c4238c41c3faf33748aee60.png" /></p>
</div>
</div>
<div id="da0dbb39" class="cell code">
<div class="sourceCode" id="cb46"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">11</span>,<span class="dv">5</span>),dpi<span class="op">=</span><span class="dv">120</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(wspace<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>label<span class="op">=</span>[<span class="st">&#39;Euler-Maruyama&#39;</span>,<span class="st">&#39;Milstein&#39;</span>,<span class="st">&#39;Closed-form&#39;</span>]</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>linestyle<span class="op">=</span>[<span class="st">&#39;-&#39;</span>,<span class="st">&#39;-&#39;</span>,<span class="st">&#39;:&#39;</span>]</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">0</span>].plot(sigmas,prices[:,<span class="dv">1</span>,i],label<span class="op">=</span>label[i],linestyle<span class="op">=</span>linestyle[i])</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].plot(sigmas,binary,label<span class="op">=</span><span class="st">&#39;Black-Scholes&#39;</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].legend()</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="vs">r&#39;Binary call price $C_B(0)$&#39;</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="vs">r&#39;Volatility $\sigma$&#39;</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylim(bottom<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>linestyle<span class="op">=</span>[<span class="st">&#39;-&#39;</span>,<span class="st">&#39;-&#39;</span>,<span class="st">&#39;:&#39;</span>]</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    plt.plot(sigmas,(prices[:,<span class="dv">1</span>,i]<span class="op">-</span>binary)<span class="op">**</span><span class="dv">2</span>,label<span class="op">=</span>label[i],linestyle<span class="op">=</span>linestyle[i])</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylim(bottom<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].legend()</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">&#39;Squared error&#39;</span>)</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="vs">r&#39;Volatility $\sigma$&#39;</span>)<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/2f591abe7b646c7079510d4b03e642576011b7d9.png" /></p>
</div>
</div>
<div id="a0d463b3" class="cell markdown">
<p>Across different dividend yield:</p>
</div>
<div id="27f956bd" class="cell code">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># path parameters</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>S0<span class="op">=</span><span class="dv">100</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>r<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>Ds<span class="op">=</span>np.linspace(<span class="dv">0</span>,<span class="fl">0.1</span>,<span class="dv">100</span>)  <span class="co"># dividend yield</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>sigmas<span class="op">=</span>np.linspace(<span class="dv">0</span>,<span class="fl">0.8</span>,<span class="dv">100</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>T<span class="op">=</span><span class="dv">1</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>timesteps<span class="op">=</span><span class="dv">100</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>nsims_mc<span class="op">=</span><span class="dv">10000</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># contract-specific parameters</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>K<span class="op">=</span><span class="dv">100</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>vanilla<span class="op">=</span>np.zeros((Ds.size,sigmas.size))</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>binary<span class="op">=</span>np.zeros((Ds.size,sigmas.size))</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>prices<span class="op">=</span>np.zeros((Ds.size,sigmas.size,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,D <span class="kw">in</span> <span class="bu">enumerate</span>(Ds):</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    mu<span class="op">=</span>r<span class="op">-</span>D</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j,sigma <span class="kw">in</span> <span class="bu">enumerate</span>(sigmas):</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># black-scholes</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>        d2 <span class="op">=</span> (np.log(S0<span class="op">/</span>K)<span class="op">+</span>(r<span class="op">-</span>D<span class="op">-</span><span class="fl">0.5</span><span class="op">*</span>sigma<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>T) <span class="op">/</span> (sigma<span class="op">*</span>np.sqrt(T))</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>        d1 <span class="op">=</span> d2<span class="op">+</span>sigma<span class="op">*</span>np.sqrt(T)</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>        vanilla[i,j] <span class="op">=</span> S0<span class="op">*</span>np.exp(<span class="op">-</span>D<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d1)<span class="op">-</span>K<span class="op">*</span>np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d2)</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>        binary[i,j]  <span class="op">=</span> np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>norm.cdf(d2)</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>        S<span class="op">=</span>np.zeros((<span class="dv">3</span>,timesteps,nsims_mc))</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>        S[<span class="dv">0</span>]<span class="op">=</span>Euler_Maruyama(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>        S[<span class="dv">1</span>]<span class="op">=</span>Milstein(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>        S[<span class="dv">2</span>]<span class="op">=</span>closed_form(S0, mu, sigma, T, timesteps, nsims_mc, <span class="dv">42</span>)</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>        prices[i,j,<span class="dv">0</span>,:]<span class="op">=</span>np.array([(np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>((S[k,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">-</span>K)<span class="op">*</span>(S[k,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">&gt;</span>K).astype(<span class="bu">int</span>))).mean() <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)])</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>        prices[i,j,<span class="dv">1</span>,:]<span class="op">=</span>np.array([(np.exp(<span class="op">-</span>r<span class="op">*</span>T)<span class="op">*</span>((S[k,<span class="op">-</span><span class="dv">1</span>,:]<span class="op">&gt;</span>K).astype(<span class="bu">int</span>))).mean() <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)])</span></code></pre></div>
<div class="output stream stderr">
<pre><code>/tmp/ipykernel_1312/2134934672.py:22: RuntimeWarning: divide by zero encountered in scalar divide
  d2 = (np.log(S0/K)+(r-D-0.5*sigma**2)*T) / (sigma*np.sqrt(T))
</code></pre>
</div>
</div>
<div id="2557aa35" class="cell code">
<div class="sourceCode" id="cb49"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;data/Prices over volatility and dividends for error analysis.pickle&#39;</span>,<span class="st">&#39;bw&#39;</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    pickle.dump((vanilla,binary,prices),<span class="bu">file</span>)</span></code></pre></div>
</div>
<div id="d8867ce0" class="cell code">
<div class="sourceCode" id="cb50"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;data/Prices over volatility and dividends for error analysis.pickle&#39;</span>,<span class="st">&#39;br&#39;</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    (vanilla,binary,prices)<span class="op">=</span>pickle.load(<span class="bu">file</span>)</span></code></pre></div>
</div>
<div id="edc6f9b2" class="cell code">
<div class="sourceCode" id="cb51"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(subplot_kw<span class="op">=</span>{<span class="st">&quot;projection&quot;</span>: <span class="st">&quot;3d&quot;</span>},figsize<span class="op">=</span>(<span class="fl">6.4</span><span class="op">*</span><span class="fl">1.5</span>,<span class="fl">4.8</span><span class="op">*</span><span class="fl">1.5</span>))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>X,Y<span class="op">=</span>np.meshgrid(Ds,sigmas)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>f<span class="op">=</span>vanilla</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>surf <span class="op">=</span> ax.plot_wireframe(X, Y, f.T, color<span class="op">=</span><span class="st">&#39;Black&#39;</span>,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                    linewidth<span class="op">=</span><span class="dv">1</span>, antialiased<span class="op">=</span><span class="va">False</span>,rstride<span class="op">=</span><span class="dv">10</span>, cstride<span class="op">=</span><span class="dv">10</span>,label<span class="op">=</span><span class="st">&#39;Black-Scholes&#39;</span>)  <span class="co"># f.transposed because plot has reversed axes order</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    f<span class="op">=</span>prices[:,:,<span class="dv">0</span>,i]</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    surf <span class="op">=</span> ax.plot_surface(X, Y, f.T, cmap<span class="op">=</span>cm.RdBu,alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>                        linewidth<span class="op">=</span><span class="dv">0</span>, antialiased<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the z axis.</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_locator(LinearLocator(<span class="dv">10</span>))</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_formatter(<span class="st">&#39;</span><span class="sc">{x:.02f}</span><span class="st">&#39;</span>)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a color bar which maps values to colors.</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>fig.colorbar(surf, shrink<span class="op">=</span><span class="fl">0.7</span>,pad<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r&#39;Volatility $\sigma$&#39;</span>)</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="vs">r&#39;Dividend yield $D$&#39;</span>)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="vs">r&#39;European call price $C(0)$&#39;</span>)</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>ax.view_init(<span class="dv">10</span>, <span class="op">-</span><span class="dv">40</span>)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/46cbbbaea5c76e10ae5aed21a18759a3c62b7fff.png" /></p>
</div>
</div>
<div id="d41e89d0" class="cell code">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(subplot_kw<span class="op">=</span>{<span class="st">&quot;projection&quot;</span>: <span class="st">&quot;3d&quot;</span>},figsize<span class="op">=</span>(<span class="fl">6.4</span><span class="op">*</span><span class="fl">1.5</span>,<span class="fl">4.8</span><span class="op">*</span><span class="fl">1.5</span>))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>X,Y<span class="op">=</span>np.meshgrid(Ds,sigmas)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>f<span class="op">=</span>binary</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>surf <span class="op">=</span> ax.plot_wireframe(X, Y, f.T, color<span class="op">=</span><span class="st">&#39;Black&#39;</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                    linewidth<span class="op">=</span><span class="dv">1</span>, antialiased<span class="op">=</span><span class="va">False</span>,rstride<span class="op">=</span><span class="dv">10</span>, cstride<span class="op">=</span><span class="dv">10</span>,label<span class="op">=</span><span class="st">&#39;Black-Scholes&#39;</span>)  <span class="co"># f.transposed because plot has reversed axes order</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    f<span class="op">=</span>prices[:,:,<span class="dv">1</span>,i]</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    surf <span class="op">=</span> ax.plot_surface(X, Y, f.T, cmap<span class="op">=</span>cm.RdBu,alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>                        linewidth<span class="op">=</span><span class="dv">0</span>, antialiased<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the z axis.</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_locator(LinearLocator(<span class="dv">10</span>))</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_formatter(<span class="st">&#39;</span><span class="sc">{x:.02f}</span><span class="st">&#39;</span>)</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_title(&#39; &#39;*115)</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a color bar which maps values to colors.</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>fig.colorbar(surf, shrink<span class="op">=</span><span class="fl">0.7</span>,pad<span class="op">=</span><span class="fl">0.07</span>)</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r&#39;Volatility $\sigma$&#39;</span>)</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="vs">r&#39;Dividend yield $D$&#39;</span>)</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="vs">r&#39;Binary call price $C_B(0)$&#39;</span>)</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>ax.view_init(<span class="dv">10</span>, <span class="op">-</span><span class="dv">30</span>)</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/a6c3b48f463be59530c866c88d91b123b33f837c.png" /></p>
</div>
</div>
<div id="345a33e0" class="cell code">
<div class="sourceCode" id="cb53"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>X,Y<span class="op">=</span>np.meshgrid(Ds,sigmas)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(subplot_kw<span class="op">=</span>{<span class="st">&quot;projection&quot;</span>: <span class="st">&quot;3d&quot;</span>},figsize<span class="op">=</span>(<span class="fl">6.4</span><span class="op">*</span><span class="fl">1.5</span>,<span class="fl">4.8</span><span class="op">*</span><span class="fl">1.5</span>))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    f<span class="op">=</span>(prices[:,:,<span class="dv">1</span>,i]<span class="op">-</span>binary)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    surf <span class="op">=</span> ax.plot_surface(X, Y, f.T, cmap<span class="op">=</span>cm.RdBu,alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>                        linewidth<span class="op">=</span><span class="dv">0</span>, antialiased<span class="op">=</span><span class="va">False</span>)  <span class="co"># f.transposed because plot has reversed axes order</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the z axis.</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_locator(LinearLocator(<span class="dv">10</span>))</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>ax.zaxis.set_major_formatter(<span class="st">&#39;</span><span class="sc">{x:.02f}</span><span class="st">&#39;</span>)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39; &#39;</span><span class="op">*</span><span class="dv">115</span>)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a color bar which maps values to colors.</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>fig.colorbar(surf, shrink<span class="op">=</span><span class="fl">0.7</span>,pad<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r&#39;Volatility $\sigma$&#39;</span>)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="vs">r&#39;Dividend yield $D$&#39;</span>)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="vs">r&#39;Residuals of predicted binary call prices&#39;</span>)</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>ax.view_init(<span class="dv">50</span>, <span class="op">-</span><span class="dv">30</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bdbe7793daab4e5ab0d80bebf1bb11ac/56b00e7d8203bd1a6db800da56a735b4c949eeb6.png" /></p>
</div>
</div>
<div id="9f56c39f" class="cell markdown">
<p>European call prices increases with increasing volatility or
decreasing dividend. The binary call price surface shows more
interesting features. When the dividend yield is below the risk-free
rate of 0.05, the option price decreases as volatility increases. When
the dividend yield is above the risk-free rate is above the risk-free
rate, the option price increases as volatility increases.</p>
<p>In terms of error, the error in binary call price estimates is once
again significantly smaller.</p>
</div>
<div id="24480d21" class="cell markdown">
<h3 id="conclusion">Conclusion</h3>
<p>This report concerns with the pricing problem of financial
derivative. Two derivatives - European calls and binary calls - are
introduced, as well as three numerical pricing schemes based on Monte
Carlo sampling the underlying asset price. The strong order of
convergences are obtained for Euler-Maruyama and Milstein schemes. Then,
bootstrap resampling is applied to determine both standard errors and
mean squared errors for the price estimated from these numerical
schemes, by benchmarking against Black-Scholes equation. Finally, the
squared error is studied on both the strike-maturity and
volatility-dividend plane with interesting results obtained.</p>
</div>
<div id="77f402b3" class="cell markdown">
<h3 id="references">References</h3>
<ol>
<li><p>Zahri, M. (2014). Multidimensional Milstein scheme for solving a
stochastic model for prebiotic evolution. <em>Journal of Taibah
University for Science</em>, <em>8</em>(2), 186–198. <a
href="https://doi.org/10.1016/j.jtusci.2013.12.002"
class="uri">https://doi.org/10.1016/j.jtusci.2013.12.002</a></p></li>
<li><p>Chen, N., &amp; Huang, Z. (2013). Localization and Exact
Simulation of Brownian Motion-Driven Stochastic Differential Equations.
<em>Mathematics of Operations Research</em>, <em>38</em>(3), 591–616. <a
href="http://www.jstor.org/stable/24540871"
class="uri">http://www.jstor.org/stable/24540871</a></p></li>
<li><p>Clarté, L., Vandenbroucque, A., Dalle, G., Loureiro, B.,
Krzakala, F. &amp; Zdeborová, L.. (2024). Analysis of Bootstrap and
Subsampling in High-dimensional Regularized Regression. <i>Proceedings
of the Fortieth Conference on Uncertainty in Artificial
Intelligence</i>, in <i>Proceedings of Machine Learning Research</i>
244:787-819. <a href="https://proceedings.mlr.press/v244/clarte24a"
class="uri">https://proceedings.mlr.press/v244/clarte24a</a></p></li>
</ol>
</div>
</body>
</html>
